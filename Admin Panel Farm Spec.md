# Техническое задание: Админка фермы профилей

## Общее описание
Простая веб-админка для управления и мониторинга фермы профилей с минималистичным интерфейсом в стиле Vercel.

## Технический стек
- **Backend**: Flask
- **Frontend**: HTML/CSS (без JS фреймворков)
- **База данных**: 
  - PostgreSQL (только чтение профилей для статистики)
  - SQLite (авторизация и управление админами)
- **ORM**: Flask-SQLAlchemy (два подключения)
- **Стиль UI**: Современный дизайн в стиле Vercel

## Структура проекта
```
farm_admin/
├── app.py                 # Основной файл приложения Flask
├── models.py              # Модели SQLAlchemy (для обеих БД)
├── auth.py                # Логика авторизации
├── admin.db               # SQLite БД для админов (создается автоматически)
├── static/
│   ├── css/
│   │   └── style.css      # Основные стили
│   └── js/
│       └── main.js        # Минимальный JS (если нужен)
├── templates/
│   ├── base.html          # Базовый шаблон
│   ├── login.html         # Страница входа
│   ├── dashboard.html     # Главная страница (дашборд)
│   ├── admins.html        # Управление админами
│   └── tools.html         # Страница инструментов
└── requirements.txt       # Зависимости Python
```

## Функциональные требования

### 1. Система авторизации
- **Страница входа**: форма с логином и паролем
- **SQLite БД**: отдельная база для хранения админов
- **Дефолтный админ**: при первом запуске создается admin/admin
- **Защита роутов**: неавторизованные пользователи видят только страницу входа
- **Сессии**: использование Flask sessions для хранения состояния авторизации

### 2. Макет интерфейса
- **Левое меню**: фиксированное боковое меню с вкладками
- **Разделитель**: вертикальная полоска между меню и контентом
- **Основная область**: контент выбранной вкладки

### 3. Навигация (левое меню)
- **Дашборд** (по умолчанию активен)
- **Управление админами** (создание/удаление админов)
- **Инструменты** (заглушка с текстом "Инструменты в разработке")

### 4. Дашборд - статистика
#### Глобальная статистика:
- Общее количество профилей в БД
- Средний возраст профиля (в днях от data_create до текущей даты)
- Среднее количество доменов в профилях (поле domaincount)

#### Статистика по группам:
- Список всех групп профилей (поле party)
- Для каждой группы:
  - Количество профилей в группе
  - Средний возраст профилей в группе
  - Среднее количество доменов в группе

### 5. Управление админами
- **Список админов**: таблица с логинами и датой создания
- **Добавление админа**: форма с полями логин/пароль
- **Удаление админа**: кнопка удаления (нельзя удалить последнего админа)
- **Валидация**: проверка уникальности логинов

## Модель данных

### Таблица profiles (PostgreSQL, существующая, только чтение)
Используется существующая таблица со следующими ключевыми полями:
- `pid` (int4, PK) - ID профиля
- `data_create` (timestamptz) - дата создания
- `party` (varchar) - группа профиля
- `domaincount` (int4) - количество доменов
- Остальные поля существуют, но не используются в текущей версии

### Таблица users (SQLite, создается автоматически)
```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### Инициализация по умолчанию:
При первом запуске приложения автоматически создается админ:
- Логин: `admin`
- Пароль: `admin`

## UI/UX требования

### Дизайн в стиле Vercel:
- **Цветовая схема**: светлая тема, белый фон, темно-серый текст
- **Типографика**: современные шрифты (система или Inter/SF Pro)
- **Карточки**: белые блоки с тенями для статистики
- **Минимализм**: чистый интерфейс без лишних элементов
- **Отзывчивость**: базовая адаптивность под разные экраны

### Компоненты:
- Карточки статистики с числовыми показателями
- Таблица групп с данными
- Таблица админов с кнопками управления
- Формы добавления админов
- Боковое меню с активными состояниями
- Форма авторизации

## Технические детали

### Flask приложение:
- Использование Blueprint'ов для организации роутов
- Flask-Login или простые сессии для авторизации
- Два подключения SQLAlchemy:
  - PostgreSQL (только чтение) для статистики
  - SQLite для управления админами
- Конфигурация через переменные окружения
- Автоматическая инициализация SQLite БД и дефолтного админа

### Безопасность:
- Хеширование паролей (bcrypt или Werkzeug)
- CSRF защита для форм
- Проверка авторизации на всех защищенных роутах

### База данных:
- Подключение к существующей PostgreSQL БД profiles (только чтение)
- Автоматическое создание SQLite БД для админов
- SQL запросы для агрегации статистики из PostgreSQL
- CRUD операции для админов в SQLite

## Этапы реализации

1. **Настройка окружения**: Flask app, два подключения к БД
2. **Модели данных**: SQLAlchemy модели для обеих БД
3. **Авторизация**: login/logout + инициализация дефолтного админа
4. **Базовый макет**: HTML шаблоны и CSS
5. **Дашборд**: логика получения и отображения статистики
6. **Управление админами**: CRUD операции для админов
7. **Финальная стилизация**: доведение дизайна до стиля Vercel

## Ограничения текущей версии
- Управление админами (создание/удаление)
- Просмотр статистики профилей (без редактирования самих профилей)
- Одна роль пользователя (все админы равноправны)
- Базовая функциональность без сложной логики
- Инструменты - заглушка для будущего расширения
- PostgreSQL используется только для чтения статистики